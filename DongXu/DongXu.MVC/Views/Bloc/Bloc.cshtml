<!DOCTYPE html>
@{
    ViewBag.Title = "Bloc";
    Layout = "~/Views/Shared/_TestLayout.cshtml";
}
<HTML>
<HEAD>
    <TITLE> ZTREE DEMO </TITLE>
    @*<link href="~/demo.css" rel="stylesheet" />*@
    <script src="~/Scripts/jquery-1.4.4.min.js"></script>
    <link href="~/metroStyle/metroStyle.css" rel="stylesheet" />
    <link href="~/zTreeStyle/zTreeStyle.css" rel="stylesheet" />

    <script src="~/Scripts/jquery.ztree.core.js"></script>

    <script src="~/Scripts/axios.js"></script>
    <script src="~/Scripts/vue.js"></script>

    <SCRIPT>
        $(function () {
            $("#Addbtn").click(function () {
             
                $.ajax({

                    url: 'http://localhost:8098/Bloc/AddBloc',
                    type: 'post',
                
                    data: $("#FormData").serialize(),
                    success: function (data) {
                        if (data > 0) {
                            location.href='/Bloc/Bloc';
                        }
                        else {
                            alert("添加失败")
                        }
                    }
                })

            })


                $.ajax(
                    {
                        url: 'http://localhost:8098/Bloc/GetBloc',
                        type: 'get',
                        success: function (data) {
                            $(data).each(function (index, data) {
                                $("#s2").append("<option value='"+data.id+"'>" + data.name + "</option>")
                            })

                        }

                    })


        })
        $(function () {
            $("#Xiubtn").click(function () {

                $.ajax({

                    url: 'http://localhost:8098/Bloc/UpdateBloc',
                    type: 'post',
                    data: $("#FormData").serialize(),
                    success: function (data) {
                   
                        if (data > 0) {
                            alert("修改成功")
                        }
                        else {
                            alert("修改失败")
                            alert(data)
                        }
                    }
                })

            })
        })
        //var zTreeObj;
        //var setting = {};        // zTree 的参数配置，后面详解
        function zTreeOnClick(event, treeId, treeNode) {

            console.log(treeNode);
            console.log(treeNode.pId);
            $("input[name=name]").val(treeNode.name);
            if (treeNode.pId == 0) {
                $("select[name=pId] option[value=0]").attr("selected", "selected");
            }
            else {
                $("select[name=pId] option[value=" + treeNode.pId + "]").attr("selected", "selected");
            }
            


            // alert(treeNode.tId + ", " + treeNode.name);
        };
        var setting = {
            data: {
                simpleData: {
                    enable: true,
                    idKey: "id",
                    pIdKey: "pId",
                    rootPId: 0
                }
            },
            callback: {
                onClick: zTreeOnClick
            }
        };
        //var zNodes = [           // zTree 的数据属性，此处使用标准json格式
        //    {
        //        name: "东旭控股集团", open: true, children: [
        //            {
        //                name: "东旭光电", open: true, children:
        //                    [{
        //                        name: "东旭建设集团", open: true, children:
        //                            [{
        //                                name: "财务管理部", open: true, children:
        //                                    [{ name: "财务管理部总经理" }]
        //                            }, { name: "投资拓展部" }, { name: "产品定制部" }, { name: "销售管理部" }, { name: "成本管理部" }, { name: "人力行政部" }, { name: "设计管理部" }]
        //                    },{ name: "光电显示材料" }, { name: "高端装备制造" }, { name:"石墨烯产业化" }, { name:"新能源汽车" }, { name:"装备贸易" }]
        //            }, { name: "东旭蓝天" }, { name: "嘉麟杰"}, { name: "产业发展集团" }, { name: "东旭资本" }, { name: "职能部门" }]
        //    },



        //];
        var zNodes = [];

        $(document).ready(function () {
            $.ajax({
                url: "http://localhost:8098/Bloc/GetBloc",
                success: function (data) {
                    zNodes = data;
                    zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, zNodes); //初始化zTree，三个参数一次分别是容器(zTree 的容器 className 别忘了设置为 "ztree")、参数配置、数据源

                }

            });

        });
        @*$(document).ready(function () {
            $.ajax({
                data:
                {
                      id:@Request.QueryString["id"],
                },
                url: 'http://localhost:8098/Bloc/GetBlocById',
                success: function (data) {
                    $("input[name=name]").val(data.name);
                    $("select[name=Pid] option[value=" + data.Pid + "]").attr("checked", "checked");

                }

            });

        });*@
        function addDiyDom(treeId, treeNode) {
            var spaceWidth = 5;
            var switchObj = $("#" + treeNode.tId + "_switch"),
                icoObj = $("#" + treeNode.tId + "_ico");
            switchObj.remove();
            icoObj.before(switchObj);

            if (treeNode.level > 1) {
                var spaceStr = "<span style='display: inline-block;width:" + (spaceWidth * treeNode.level) + "px'></span>";
                switchObj.before(spaceStr);
            }
        }


    </SCRIPT>
    <style>
        .ztree * {
            color: blue;
            font-size: 10pt;
            font-family: "Microsoft Yahei",Verdana,Simsun,"Segoe UI Web Light","Segoe UI Light","Segoe UI Web Regular","Segoe UI","Segoe UI Symbol","Helvetica Neue",Arial
        }

            .ztree li {
                line-height: 20px;
            }

                .ztree li a {
                    width: 200px;
                    height: 30px;
                    padding-top: 0px;
                }

                    .ztree li a:hover {
                        text-decoration: none;
                        background-color: #E7E7E7;
                    }

                    .ztree li a span.button.switch {
                        visibility: hidden
                    }

                    .ztree li a.curSelectedNode {
                        background-color: #D4D4D4;
                        border: 0;
                        height: 30px;
                    }
        </style>
</HEAD>
<BODY>
  
   
    <div>

        <ul id="treeDemo" class="ztree" style="height:500px;border:1px solid #ffffff;float:left; background-color:#ffffff" ></ul>
        <h6 style="float:left">您当前的位置:系统管理>>组织管理</h6>
        <form id="FormData" enctype="multipart/form-data" method="post">
            <table style="float:left;margin-left:300px;margin-top:150px;margin-right:60px;border-collapse:separate; border-spacing:0px 50px;" ;>
                <tr style="display:none">
                    <td>
                       <input type="text" name="id" readonly:readonly />
                    </td>

                </tr>
                <tr>
                    <td>
                        组织名称:
                    </td>
                    <td>
                        <input id="Text1" type="text" name="name" />
                    </td>
                    <td>
                        组织层级:
                    </td>
                    <td>
                        <select id="s2" name="pId">
                            <option value="0">请选择</option>

                        </select>
                    </td>
                </tr>
                <tr>
                    <td>组织状态</td>
                    <td>
                        <input id="Radio1" type="radio" name="IsOrNo" checked="checked">启用
                        <input type="radio" name="IsOrNo" />禁用
                    </td>
                </tr>

            </table>
            <table style="float:left;margin-left:40px;margin-top:300px;margin-right:20px;border-collapse:separate; border-spacing:0px 50px;" ;>
                <tr>
                    <td>
                        <input type="button" value="新增" id="Addbtn" style="background-color:#ffffff;border:none;width:80px;height:50px" />
                    </td>

                

                    @*<td>
                        <input type="button" value="修改" id="Xiubtn" style="background-color:#ffffff;border:none;width:80px;height:50px"/>
                    </td>*@
                </tr>
            </table>
        </form>

    </div>

</BODY>
</HTML>