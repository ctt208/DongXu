
@{
    ViewBag.Title = "RoleIndex";
    Layout = "~/Views/Shared/_TestLayout.cshtml";
}

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link href="~/Content/layui-v2.4.5/layui/css/layui.css" rel="stylesheet" />
    <script src="~/Scripts/axios.js"></script>
    <script src="~/Scripts/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>

    @*<script src="~/Content/BootstrapSouce/js/bootstrap.min.js"></script>
        <link href="~/Content/BootstrapSouce/css/bootstrap.css" rel="stylesheet" />*@
    <script src="~/Scripts/jquery-3.1.1.js"></script>
    <style>
        .page-bar {
            margin: 40px;
        }

        ul, li {
            margin: 0px;
            padding: 0px;
        }

        li {
            list-style: none
        }

        .page-bar li:first-child > a {
            margin-left: 0px
        }

        .page-bar a {
            border: 1px solid #ddd;
            text-decoration: none;
            position: relative;
            float: left;
            padding: 6px 12px;
            margin-left: -1px;
            line-height: 1.42857143;
            color: #337ab7;
            cursor: pointer
        }

            .page-bar a:hover {
                background-color: #eee;
            }

            .page-bar a.banclick {
                cursor: not-allowed;
            }

        .page-bar .active a {
            color: #fff;
            cursor: default;
            background-color: #337ab7;
            border-color: #337ab7;
        }

        .page-bar i {
            font-style: normal;
            color: #d44950;
            margin: 0px 4px;
            font-size: 12px;
        }
    </style>
    <script>
        function fan() {
            //alert(localStorage.id);
            console.log(localStorage.id)
            $.ajax({
                url: 'http://localhost:8098/RolePermisson/showRolesById?id=' + localStorage.id,
                type: 'get',
                success: function (data) {
                    console.log(data);
                    $("input[name=RoleID]").val(localStorage.id)
                    $("input[name=RoleName]").val(data[0].RoleName);
                    
                    $(data).each(function (index, data) {
                        console.log(data.PerMissionID)
                        $("input[name=PerMissionID][value="+data.PerMissionID+"]").prop("checked", true)
                    })
                }
            })

        }



        function Show() {
            $.ajax({
                url: 'http://localhost:8098/DongXu/GetPerMissions',
                type: 'get',
                success: function (data) {
                    $(":checkbox").remove();
                    $(".span").remove();
                    $(data).each(function (index, data) {
                        var str = '<input type="checkbox"  name="PerMissionID" value="' + data.PerMissionID + '" /><span class="span">' + data.PerMissionName + '</span>'
                        $("#check").append(str);
                    })
                }
            })
        }
        function Modalwindow() {
            fan();
            Show();
            //alert(10);
            layer.open({
                type: 1,
                area: ['600px', '400px'],
                fix: false, //不固定
                maxmin: true,
                shade: 0.7,
                title: '添加用户',
                content: $("#AddUser")
            });
        }



    </script>
</head>
<body>
    <a href="http://localhost:51281/RolesMVC/Add">添加</a>
    <div id="app">
        名称:<input id="name" type="text" v-model="inquire" /><input type="button" v-on:click="getList()" value="搜索" />
        <table v-show="list.length" class="layui-table">
            <tr>
                <th>角色ID</th>
                <th>角色名称</th>
                <th>角色描述</th>
                <th>操作</th>
            </tr>
            <tr v-for="(item,index) in list">
                <td> <input type="text" class="layui-input" disabled="disabled" v-model="item.RoleID" /></td>
                <td><input type="text" class="layui-input" v-model="item.RoleName" /></td>
                <td><input type="text" class="layui-input" v-model="item.RoleDescribe" /></td>
                <td>
                    <a href="#" v-on:click="set(item.RoleID)" onclick="Modalwindow()">设置</a>
                    <a href="#" v-on:click="delete1(item.RoleID)">删除</a>
                    @*<a href="#" v-on:click="updateRole(item.RoleID,item.RoleName,item.RoleDescribe)">修改</a>*@
                </td>
            </tr>
        </table>
        <div class="page-bar">
            <ul>
                <li v-if="cur>1"><a v-on:click="cur--,pageClick()">上一页</a></li>
                <li v-if="cur==1"><a class="banclick">上一页</a></li>
                <li v-for="index in indexs" v-bind:class="{ 'active': cur == index}">
                    <a v-on:click="btnClick(index)">{{ index }}</a>
                </li>
                <li v-if="cur!=all"><a v-on:click="cur++,pageClick()">下一页</a></li>
                <li v-if="cur == all"><a class="banclick">下一页</a></li>
                <li><a>共<i>{{all}}</i>页</a></li>
            </ul>
        </div>
    </div>
    <div id="AddUser" style="display:none">
        <table>
            <tr>
                <td>
                    <span>角色名称:</span>
                </td>
                <td>
                    <input id="RoleName" type="text" name="RoleName" />
                </td>
            </tr>
            
            <tr>
                <td>
                    <span>权限:</span>
                </td>
                <td id="check">

                </td>
            </tr>
        </table>

    </div>
</body>
</html>
<script type="text/javascript">
//v-bind:value="item.RoleID" v-model="item.RoleID" >{{item.RoleID}}
    ///实例化一个Vue对象
    var vm = new Vue({
        ///作用域
        el: "#app",
        data: {
            list: [],
            inquire: "",
            all: 8,
            cur: 1

        },
        ///文档就绪函数
        mounted() {
            this.getList();
            //this.cha();
        },
        methods: {
            set: function (data) {

                localStorage.id = data;
                //alert(localStorage.id);

            },
            getList: function () {
                //alert(0);
                //var name=  $("#name").val();
                axios.get('http://localhost:8098/Role/GetRoles?name=' + this.inquire + '&currentpage=' + this.cur).then((response) => {
                    //alert(0);
                    this.list = [];
                    this.cur = response.data.CurrentPage;
                    this.all = response.data.TotlePage;
                    //console.log(response.data.PageData);
                    for (var i = 0; i < response.data.PageData.length; i++) {
                        this.list.push(response.data.PageData[i]);
                    }
                    //console.log(this.list);
                },
                    (response) => {
                        alert(response.status);
                    }
                ).catch(function (response) {
                    alert(response);
                });
            },
            btnClick: function (data) {//页码点击事件
                if (data != this.cur) {
                    this.cur = data;
                    this.getList();
                }
            },
            pageClick: function () {
                //console.log('现在在' + this.cur + '页');
                this.getList();
            },
            //getAllUser: function (data) {
            //    alert(0);
            //    //var name=  $("#name").val();
            //    axios.get('http://localhost:8098/Role/GetRoles?name=' + data + '&currentpage=' + thi.cur).then((response) => {

            //        this.list = [];
            //        this.cur = response.data.CurrentPage;
            //        this.all = response.data.TotlePage;
            //        console.log(response.data);
            //        for (var i = 0; i < response.data.PageData.length; i++) {
            //            this.list.push(response.data.PageData[i]);
            //        }
            //    },
            //        (response) => {
            //            alert(response.status);
            //        }
            //    ).catch(function (response) {
            //        alert(response);
            //    });
            //},

            delete1: function (id) {

                axios.post('http://localhost:8098/Role/DelteRole?id=' + id).then((response) => {


                    //console.log(response.data);
                    if (response.data.length > 0) {
                        alert("删除成功!");
                        this.getList();
                    }
                },
                    (response) => {
                        alert(response.status);
                    }
                ).catch(function (response) {
                    alert(response);
                });
            },
            updateRole: function (RoleID, RoleName, RoleDescribe) {
                var params = new URLSearchParams();
                params.append('RoleID', RoleID);
                params.append('RoleName', RoleName);
                params.append('RoleDescribe', RoleDescribe);
                axios.post('http://localhost:8098/Role/UpdateRole', params).then(
                    (Response) => {
                        if (Response.data > 0) {
                            alert("修改成功!!");
                            this.getList();
                        }
                    },
                    (Response) => {
                        alert(Response.status);
                    }
                ).catch (function (response) {
                    alert(response);
                });
            }
        },
        computed: {
            indexs: function () {
                var left = 1;
                var right = this.all;
                var ar = [];
                if (this.all >= 5) {
                    if (this.cur > 3 && this.cur < this.all - 2) {
                        left = this.cur - 2
                        right = this.cur + 2
                    } else {
                        if (this.cur <= 3) {
                            left = 1
                            right = 5
                        } else {
                            right = this.all
                            left = this.all - 4
                        }
                    }
                }
                while (left <= right) {
                    ar.push(left)
                    left++
                }
                return ar
            }

        }
    });

</script>

